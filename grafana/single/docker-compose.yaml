services:
  grafana:
    image: grafana/grafana:11.3.0
    container_name: grafana
    restart: unless-stopped
    ports:
      - "3000:3000"      # Grafana web UI
    environment:
      GF_SECURITY_ADMIN_USER: ${GF_SECURITY_ADMIN_USER:-admin}       # Default admin username
      GF_SECURITY_ADMIN_PASSWORD: ${GF_SECURITY_ADMIN_PASSWORD:-admin} # Default admin password
      GF_SERVER_DOMAIN: ${GF_SERVER_DOMAIN:-localhost}               # Server domain
      GF_SERVER_ROOT_URL: ${GF_SERVER_ROOT_URL:-http://localhost:3000/} # Public URL
      GF_USERS_ALLOW_SIGN_UP: ${GF_USERS_ALLOW_SIGN_UP:-false}       # Disable public sign-up
      GF_AUTH_ANONYMOUS_ENABLED: ${GF_AUTH_ANONYMOUS_ENABLED:-false} # Disable anonymous access
    volumes:
      - grafana_data:/var/lib/grafana       # Persistent data storage
      - grafana_provisioning:/etc/grafana/provisioning # Dashboards & datasources
    networks:
      - grafana_net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 5

volumes:
  grafana_data:
  grafana_provisioning:

networks:
  grafana_net:
